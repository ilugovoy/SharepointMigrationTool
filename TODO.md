# TODO-лист для проекта SP_migration_tool  

<!-- TOC tocDepth:2..3 chapterDepth:2..6 -->
- [TODO-лист для проекта SP\_migration\_tool](#todo-лист-для-проекта-sp_migration_tool)
  - [Структура в задумке](#структура-в-задумке)
    - [SP\_SiteUploader](#sp_siteuploader)
      - [SourceRenamer](#sourcerenamer)
      - [GeneratorCSV](#generatorcsv)
      - [SplitterCSV](#splittercsv)
      - [SourceUploader](#sourceuploader)
    - [SP\_GroupAndMembersMaster](#sp_groupandmembersmaster)
      - [MembersDownloaderCOM](#membersdownloadercom)
      - [GroupCreator](#groupcreator)
      - [MembersUploaderRU](#membersuploaderru)
    - [SP\_SiteMaster](#sp_sitemaster)
      - [SiteCrator](#sitecrator)
      - [LibraryMaster](#librarymaster)
    - [SP\_ReportGenerator](#sp_reportgenerator)
  - [TODO](#todo)
    - [Задачи общее](#задачи-общее)
  - [Заметки по задачам](#заметки-по-задачам)
    - [Автоматическое создание групп Owners, Members, Visitors для сайта](#автоматическое-создание-групп-owners-members-visitors-для-сайта)
    - [Загрузка в группы Owners, Members, Visitors пользователей](#загрузка-в-группы-owners-members-visitors-пользователей)
    - [Логирование](#логирование)
    - [Обработка ошибок](#обработка-ошибок)
    - [Логин в SharePoint](#логин-в-sharepoint)
    - [Улучшение производительности](#улучшение-производительности)
    - [Поддержка разных типов библиотек](#поддержка-разных-типов-библиотек)
    - [Автоматизация сбора сайтов из корня](#автоматизация-сбора-сайтов-из-корня)
    - [Параллельная обработка сайтов](#параллельная-обработка-сайтов)
    - [Автоматическое создание библиотек на SharePoint](#автоматическое-создание-библиотек-на-sharepoint)
    - [Поддержка инкрементальной миграции](#поддержка-инкрементальной-миграции)
    - [Уведомления о завершении](#уведомления-о-завершении)
<!-- /TOC -->  

---
## Структура в задумке

SP_migration_tool/
- [x] SP_SiteUploader             # Загрузка сайтов
  - [x] SourceRenamer             # Проверка и переименование
  - [x] GeneratorCSV              # Сборка путей в csv
  - [x] SplitterCSV               # Сплит больших библиотек
  - [x] SourceUploader            # Загрузка файлов на сайт
- [ ] SP_GroupAndMembersMaster    # Создание пользователей и групп
  - [ ] MembersDownloaderSRC      # Загрузка пользователей с источника
  - [ ] GroupCreator              # Создание групп
  - [ ] MembersUploaderDST        # Внесение пользователей в группы
- [ ] SP_SiteMaster               # Менеджер сайтов
  - [ ] SiteCreator               # Создание сайта
  - [ ] LibraryCreator            # Создание библиотек
- [ ] SP_ReportGenerator          # Создание отчёта

-----
### SP_SiteUploader
Этот модуль отвечает за загрузку данных на сайт SharePoint. Он включает в себя несколько подкомпонентов:

#### SourceRenamer
Задача: Переименование исходных файлов и папок перед загрузкой на SharePoint.

Функции:
- Приведение имен файлов и папок к стандартному формату (например, удаление запрещенных символов, приведение к нижнему или верхнему регистру).
- Возможность массового переименования файлов и папок по заданным правилам (например, добавление префиксов, суффиксов, замена пробелов на подчеркивания).
- Логирование изменений для отслеживания переименований.

#### GeneratorCSV
Задача: Генерация CSV-файла с метаданными для загрузки на SharePoint.

Функции:
- Сканирование локальной файловой системы (исходной папки) и создание CSV-файла с информацией о файлах и папках (например, путь, имя, размер, дата изменения).
- Возможность настройки структуры CSV-файла (например, добавление колонок для SharePoint-путей, библиотек, папок).
- Поддержка фильтрации файлов по расширениям, размеру или другим параметрам.

#### SplitterCSV
Задача: Разделение большого CSV-файла на несколько частей для удобства обработки.

Функции:
- Разделение CSV-файла на несколько файлов по заданному количеству строк или размеру.
- Возможность настройки правил разделения (например, по библиотекам, папкам или другим критериям).
- Логирование процесса разделения для отслеживания созданных файлов.

#### SourceUploader
Задача: Загрузка файлов и папок на SharePoint на основе CSV-файла.

Функции:
- Чтение CSV-файла и загрузка файлов и папок на SharePoint в указанные библиотеки и папки.
- Поддержка проверки существования файлов и папок на SharePoint (чтобы избежать дублирования).
- Логирование процесса загрузки (успешные загрузки, пропущенные файлы, ошибки).
- Возможность повторной загрузки в случае ошибок.

### SP_GroupAndMembersMaster
Этот модуль отвечает за управление группами и пользователями на SharePoint.

Функции:
- Настройка прав доступа для пользователей и групп.
- Экспорт и импорт прав доступа в CSV-файл.
- Логирование изменений прав доступа.

#### MembersDownloaderCOM
Задача: Загрузка информации о пользователях и группах из SharePoint.

Функции:
- Экспорт списка пользователей и групп из SharePoint в CSV или другой формат.
- Возможность фильтрации данных (например, только активные пользователи, только определенные группы).
- Логирование процесса экспорта.

#### GroupCreator
Задача: Создание групп на SharePoint.

Функции:
- Создание новых групп на основе данных из CSV-файла или другого источника.
- Настройка прав доступа для групп (например, чтение, запись, полный доступ).
- Логирование создания групп.

#### MembersUploaderRU
Задача: Загрузка пользователей в группы на SharePoint.

Функции:
- Добавление пользователей в группы на основе данных из CSV-файла.
- Проверка существования пользователей и групп перед добавлением.
- Логирование процесса добавления пользователей.

### SP_SiteMaster
Этот модуль отвечает за создание и настройку сайтов и библиотек на SharePoint.

#### SiteCrator
Задача: Создание сайта на SharePoint.

Функции:
- Создание новых сайтов на основе файла источника.
- Логирование.

#### LibraryMaster
Задача: Управление библиотеками документов на SharePoint.

Функции:
- Создание новых библиотек документов на основе шаблонов или настроек.
- Настройка прав доступа для библиотек (например, доступ для определенных групп или пользователей).
- Логирование создания и настройки библиотек.

### SP_ReportGenerator
Задача: Генерация отчетов о состоянии сайтов, библиотек, пользователей и групп.

Функции:
- Создание отчетов в формате CSV, Excel или PDF.
- Возможность настройки параметров отчетов (например, список файлов, права доступа, активные пользователи).
- Логирование генерации отчетов.

## TODO

### Задачи общее
- [x] Добавить поддержку длинных путей
- [x] Обработка ошибок
- [x] Статистика в логах
- [ ] Логин в SharePoint
- [ ] Автоматическое создание групп Owners, Members, Visitors для сайта
- [ ] Загрузка в группы Owners, Members, Visitors пользователей
- [x] Параллельная обработка сайтов
- [ ] Автоматическое создание библиотек на сайте SharePoint
- [ ] Автоматическое создание сайтов и подсайтов
- [ ] Автоматизация сбора сайтов из корня 

## Заметки по задачам

### Автоматическое создание групп Owners, Members, Visitors для сайта
У Сергея есть для этого скрипт, адаптировать

### Загрузка в группы Owners, Members, Visitors пользователей
У Сергея вроде есть для этого скрипт.
Скрипт должен принимать список юзеров из файла или другого скрипта и добавлять их в группы с валидацией существуют они или нет.

### Логирование
Добавить уникальные идентификаторы для каждой миграции.
Логировать время начала и окончания каждой задачи.
Сохранять логи в структурированные папки (например, `M:\MIGRATION_LOGS\Russia\2025-03-15\logfile.txt`).

### Обработка ошибок
Если миграция одного сайта завершилась с ошибкой, это не должно останавливать миграцию других сайтов. Логировать ошибки и предлагать варианты их исправления.

### Логин в SharePoint
Добавить возможность указать данные для входа (логин, пароль) при запуске скрипта.
Автоматически проверять доступ к SharePoint перед началом миграции.

### Улучшение производительности
Оптимизировать чтение и запись файлов  
Использовать кэширование данных в памяти  
Минимизировать количество операций с диском  

### Поддержка разных типов библиотек
Добавить возможность работы с разными типами библиотек SharePoint (например, документы, изображения, видео).

### Автоматизация сбора сайтов из корня 
На вход скрипт принимает:
- Список названий сайтов (например, Russia, Germany, France).
- Корневую папку, где лежат папки с сайтами (например, `M:\MigrationMaster`).
Скрипт самостоятельно ищет папки с названиями сайтов в корневой папке (например, `M:\MigrationMaster\Russia - Site Assets`). Автоматически определяет библиотеки (например, `Site Assets`, `Pages`) на основе структуры папок.

### Параллельная обработка сайтов
Скрипт должен автоматически параллелить обработку сайтов, чтобы несколько миграций могли выполняться одновременно. Ограничение на количество параллельных задач (например, не более 3 одновременно).

### Автоматическое создание библиотек на SharePoint
Если библиотеки на SharePoint не существуют, скрипт должен автоматически создавать их на основе структуры локальных папок (например `Site Assets` из пути `M:\MigrationMaster\Russia - Site Assets`).

### Поддержка инкрементальной миграции
Добавить возможность мигрировать только изменённые файлы (инкрементальная миграция).

### Уведомления о завершении
Добавить возможность отправки уведомлений (например, по email или в Teams) о завершении миграции.